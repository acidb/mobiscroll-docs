import { Parameter } from '@site/src/components/Connect';

# Webhooks API

## Subscribe to Webhook {#endpoint-subscribe-webhook}

Creates a webhook subscription to receive real-time notifications when calendar events change.

Registers the subscription with the provider's API and stores the channel mapping in the database. For Google Calendar, performs an initial sync to establish a sync token. Automatically unsubscribes from any existing subscriptions for the same calendar before creating a new one.

**Endpoint:** `POST /subscribe-webhook`

### Request Parameters


<Parameter name="provider" type="string" required id="subscribe-provider">
Provider name to subscribe to. Possible values:
- `'google'` - Google Calendar
- `'microsoft'` - Microsoft Outlook
- `'apple'` - Apple Calendar

</Parameter>

<Parameter name="calendarId" type="string" required id="subscribe-calendarId">
Calendar ID to subscribe to. This is the unique identifier of the calendar from the provider.
</Parameter>

<Parameter name="channelId" type="string" defaultValue={<code>undefined</code>} id="subscribe-channelId">
Optional custom channel ID. If not provided, a unique channel ID will be auto-generated by the provider.
</Parameter>

<Parameter name="expiration" type="number" defaultValue={<code>undefined</code>} id="subscribe-expiration">
Optional subscription expiration timestamp in milliseconds. Provider-specific behavior applies.
</Parameter>

### Response


<Parameter name="success" type="boolean" id="subscribe-response-success">
Operation success status.
</Parameter>

<Parameter name="provider" type="string" id="subscribe-response-provider">
Provider name.
</Parameter>

<Parameter name="subscription" type="object" id="subscribe-response-subscription">
Subscription details from provider containing:

<Parameter name="channelId" type="string">
Unique channel identifier
</Parameter>

<Parameter name="resourceId" type="string">
Resource identifier (for Google) (optional)
</Parameter>

<Parameter name="expiration" type="Date">
Subscription expiration date (optional)
</Parameter>

</Parameter>

<Parameter name="serverWebhookUrl" type="string" id="subscribe-response-serverWebhookUrl">
Server endpoint receiving notifications from the provider.
</Parameter>

<Parameter name="channelId" type="string" id="subscribe-response-channelId">
The channel ID used for this subscription.
</Parameter>

### Error Responses

- **400** - Bad Request. Missing required parameters, provider not supported, or webhook URL not configured
- **401** - Unauthorized. Invalid or missing bearer token
- **500** - Internal Server Error. Provider API error or unexpected failure

### Examples

```bash title="Subscribe to Google Calendar webhook"
POST /subscribe-webhook
```

```json title="Request body"
{
  "provider": "google",
  "calendarId": "work@company.com",
  "channelId": "my-custom-channel-123",
  "expiration": 1735689600000
}
```

```json title="Response"
{
  "success": true,
  "provider": "google",
  "subscription": {
    "channelId": "my-custom-channel-123",
    "resourceId": "o5gKFEAS...",
    "expiration": "2025-10-27T10:00:00.000Z"
  },
  "channelId": "my-custom-channel-123"
}
```

:::info
- Any existing subscriptions for the same calendar are automatically unsubscribed before creating a new one
- Google and Microsoft providers perform an initial sync to establish a sync token
:::

---

## Unsubscribe from Webhook {#endpoint-unsubscribe-webhook}

Stops receiving webhook notifications for a specific calendar subscription.

Calls the provider's unsubscribe API and removes the channel mapping from the database. Even if the provider unsubscribe fails (e.g., expired subscription), the local mapping is removed.

**Endpoint:** `POST /unsubscribe-webhook`

### Request Parameters

#### provider {#unsubscribe-provider}

*string*

Provider name to unsubscribe from. Possible values:
- `'google'` - Google Calendar
- `'microsoft'` - Microsoft Outlook
- `'apple'` - Apple Calendar

**Required**

#### channelId {#unsubscribe-channelId}

*string*

Unique channel/subscription ID to unsubscribe.

**Required**

#### resourceId {#unsubscribe-resourceId}

*string*

Resource ID (required for some providers like Google).

**Default value**: `undefined`

### Response

#### success {#unsubscribe-response-success}

*boolean*

Operation success status.

#### message {#unsubscribe-response-message}

*string*

Confirmation or info message.

### Error Responses

- **400** - Bad Request. Missing provider or channelId, or provider not supported
- **401** - Unauthorized. Invalid or missing bearer token
- **500** - Internal Server Error. Unexpected failure

### Examples

```bash title="Unsubscribe from webhook"
POST /unsubscribe-webhook
```

```json title="Request body"
{
  "provider": "google",
  "channelId": "channel-uuid-123",
  "resourceId": "resource-xyz-456"
}
```

```json title="Response"
{
  "success": true,
  "message": "Successfully unsubscribed"
}
```

:::info
- The local channel mapping is always removed, even if the provider unsubscribe fails
- If the subscription has already expired on the provider side, you'll receive a success message indicating the local mapping was removed
:::